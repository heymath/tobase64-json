var Tobase64JSON,fs,mime,util,_;fs=require("fs"),util=require("util"),mime=require("mime"),_=require("lodash"),Tobase64JSON=function(){function t(t){this.src="",this.dist="",this.keys_int=!1,this.keys_ext=!1,this.data_mime=!0,this.autorun=!0,this.recursive=!0,this.json_name="tobase64.json",this.exclude=[".DS_Store",".gitignore"],_.extend(this,t),this.autorun&&this.run()}var i;return i={},t.prototype._dirPath=function(t){return"/"===t.substring(t.length-1)?t:t+"/"},t.prototype._fileKey=function(t,i){var e,s,r;return this.keys_int?i:this.keys_ext?t:(r=".",s=t.split(r),e=r+s[s.length-1],t.substring(0,t.length-e.length))},t.prototype._fileToBase64=function(t){var i,e;return i=fs.readFileSync(t).toString("base64"),e=this.data_mime?"data:"+mime.lookup(t)+";base64,"+i:i,util.format(e)},t.prototype._dirToBase64=function(t,i){var e;return e=fs.readdirSync(t),_.remove(e,function(t){return-1!==this.exclude.indexOf(t)},this),_.each(e,function(e,s){var r,n;if(n=this._dirPath(t)+e,fs.lstatSync(n).isDirectory()){if(!this.recursive)return;return r=this.keys_int?s:e,i[r]={},this._dirToBase64(n,i[r])}return r=this._fileKey(e,s),i[r]=this._fileToBase64(n)},this)},t.prototype.run=function(){var t;return this._dirToBase64(this.src,i),t=this._dirPath(this.dist)+this.json_name,fs.writeFile(t,JSON.stringify(i,null,2),function(){return function(i){return console.log(i||"Finished tobase64-json: "+t)}}(this)),this},t}(),module.exports=Tobase64JSON;